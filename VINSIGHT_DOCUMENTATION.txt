==========================================
FILE: README.md
==========================================
# VinSight üìà
> **AI-Powered Stock Market Analysis Platform**

![License: Source Available](https://img.shields.io/badge/License-Source%20Available-blue)
![Status: Production](https://img.shields.io/badge/Status-Production-green)

VinSight is a comprehensive financial research tool that combines real-time stock data with AI-driven sentiment analysis to provide institutional-grade insights for the retail investor.

---

## üöÄ Key Features

- **Dynamic Scoring Engine**: Pro-grade 70/30 composite score (Fundamentals/Technicals) that adapts to 12+ industry benchmarks.
- **AI Sentinel**: Multi-source news sentiment with Groq-powered reasoning and spin detection.
- **Monte Carlo Projections**: 10,000+ simulated price paths to define Bull/Base/Bear scenarios.
- **Insider Intelligence**: SEC-filing based tracking of Monthly Share Purchase Ratios (MSPR).
- **Professional Dashboard**: High-density interactive charts and strategy mixers.

## üèÅ Quick Start

### 1. Prerequisites
- Python 3.10+, Node.js 20+
- API Keys: [Groq](https://console.groq.com), [Google AI](https://aistudio.google.com), [Alpha Vantage](https://www.alphavantage.co)

### 2. Setup
```bash
# Clone the repo
git clone https://github.com/vinayakm-93/vinsight.git && cd vinsight

# Backend Setup
cd backend && python -m venv venv && source venv/bin/activate
pip install -r requirements.txt && python main.py

# Frontend Setup (New Terminal)
cd frontend && npm install && npm run dev
```

## üìö Documentation

The project documentation is organized for clarity:

- **[Product Requirements (PRD)](docs/PRD.md)**: Vision, target audience, and core pillars.
- **[Full Feature List](docs/FEATURES.md)**: Detailed catalog of all application features.
- **[Architecture Overview](docs/ARCHITECTURE.md)**: Technical stack, system diagrams, and data flow.
- **[Scoring Engine Logic](docs/SCORING_ENGINE.md)**: Deep dive into the v9.0 Dynamic Benchmark Model.
- **[Security & Compliance](docs/SECURITY.md)**: Security audits and rotation protocols.
- **[Maintenance Log](docs/MAINTENANCE_LOG.md)**: Bug fix history and performance RCAs.
- **[Setup & Deployment](docs/SETUP.md)**: Detailed environment and Google Cloud setup.

---

## üìÑ License
¬© 2024-2026 Vinayak. This project is licensed under a custom **Source Available License**.
Modification and redistribution are prohibited. See [LICENSE](LICENSE) for details.




==========================================
FILE: docs/ARCHITECTURE.md
==========================================
# Architecture Overview

VinSight follows a modern **Client-Server Architecture** with a **Proxy Layer** for cookie handling and a micro-batching background worker for market alerts.

## 1. System Diagram

```mermaid
graph TD
    User[User Browser]
    FE[Next.js Frontend]
    Proxy[Next.js Rewrites Proxy]
    BE[FastAPI Backend]
    DB[(PostgreSQL / SQLite)]
    AI1[Groq API]
    AI2[Gemini API]
    AV[Alpha Vantage API]
    Data[yfinance]
    Worker[Cloud Run Job: Market Watcher]

    User -->|HTTP| FE
    FE -->|/api/* requests| Proxy
    Proxy -->|Forward + Cookies| BE
    BE -->|SQLAlchemy| DB
    BE -->|Sentiment| AI1
    BE -->|Earnings| AI2
    BE -->|News + Sentiment| AV
    BE -->|Stock Data| Data
    Worker -->|Check Price Targets| BE
```

## 2. Tech Stack

| Layer | Technology |
| :--- | :--- |
| **Frontend** | Next.js 14/15, TypeScript, Tailwind CSS, Framer Motion |
| **Backend** | Python 3.11, FastAPI, Pydantic, SQLAlchemy |
| **Database** | Cloud SQL (PostgreSQL 15) for Prod; SQLite for Local |
| **AI Models** | Groq (Llama 3.3 70B), Gemini 1.5 Pro, Alpha Vantage |
| **Infrastructure** | Google Cloud Run, Cloud Scheduler, Secret Manager |

## 3. Core Engine Logic
- **[VinSight Scoring Engine](./SCORING_ENGINE.md)**: Detailed breakdown of the Dynamic Benchmark Model (v9.0), Weighting profiles, and Vetos.
- **AI Sentiment Hybrid**: Parallel analysis using FinBERT (fast) and Groq (deep) with temporal weighting and spin detection.

## 4. Infrastructure & Security
- **Computing**: Scaling-to-zero Cloud Run containers for cost efficiency.
- **Secrets**: Zero-knowledge credential storage via Google Secret Manager.
- **Alerts**: Background cron job (Worker) triggered every 5 minutes during US market hours.

## 5. Detailed Technical Documentation
- **[Security & Compliance](./SECURITY.md)**: OWASP compliance, Encryption audits, and Rotation schedules.
- **[Maintenance & Incident Log](./MAINTENANCE_LOG.md)**: Fix history and Root Cause Analyses.
- **[Deployment Guide](./DEPLOY.md)**: Instructions for pushing to Google Cloud.
- **[Setup Guide](./SETUP.md)**: Local development environment configuration.





==========================================
FILE: docs/DEPLOY.md
==========================================
# Deployment Guide

We use a unified script `deploy.sh` to handle building, secrets mounting, and deploying to Google Cloud Run.

> [!WARNING]
> **RAM Requirement**: The Backend service REQUIRES a minimum of **2GiB of RAM**. Lower memory configurations will cause OOM (Out of Memory) crashes due to the Python ML dependencies (`torch`, `transformers`).

## Prerequisites
1.  **Google Cloud SDK**: [Install Here](https://cloud.google.com/sdk/docs/install)
2.  **Login**:
    ```bash
    gcloud auth login
    gcloud config set project vinsight-ai
    ```

## One-Click Deploy
To deploy Backend, Frontend, and Background Jobs:
```bash
./deploy.sh
```

> [!IMPORTANT]
> **Frontend API Proxy Configuration**: The `frontend/next.config.js` contains the backend URL for API proxying.
> - In **production**, it uses the Cloud Run backend URL: `https://vinsight-backend-wddr2kfz3a-uc.a.run.app`
> - In **development**, it uses localhost: `http://127.0.0.1:8000`
> - The switch is automatic based on `NODE_ENV`
> - **If deploying to a different backend URL**, update the production URL in `next.config.js` before deploying!

## First Time Setup (If Redeploying elsewhere)

### 1. Database Setup (Cloud SQL)
You must create a PostgreSQL instance and user.
```bash
# Create Instance
gcloud sql instances create vinsight-db --tier=db-f1-micro --region=us-central1

# Create DB & User
gcloud sql databases create finance --instance=vinsight-db
gcloud sql users create vinsight --instance=vinsight-db --password=YOUR_PASSWORD
```

### 2. Secrets Management
Store sensitive keys in Google Secret Manager:
```bash
# Use our helper script to upload local .env vars
python3 scripts/migrate_secrets.py
```
*Required Secrets:* `DB_USER`, `DB_PASS`, `JWT_SECRET_KEY`, `GROQ_API_KEY`, `FINNHUB_API_KEY`, `ALPHA_VANTAGE_API_KEY`, `API_NINJAS_KEY`, `MAIL_PASSWORD`.

### 3. Initialize Schema
Run the initialization script locally (connected via Proxy) or via a one-off Cloud Run Job task to create tables.
```bash
# Connect locally to test
./google-cloud-sdk/bin/gcloud sql connect vinsight-db --user=vinsight
```

### 4. Scheduler Setup
The `vinsight-watcher` job needs a trigger to run periodic checks.
```bash
gcloud scheduler jobs create http vinsight-market-trigger \
  --schedule="*/5 9-16 * * 1-5" \
  --time-zone="America/New_York" \
  --uri="https://us-central1-run.googleapis.com/apis/run.googleapis.com/v1/namespaces/vinsight-ai/jobs/vinsight-watcher:run" \
  --http-method=POST \
  --oauth-service-account-email=YOUR_SA_EMAIL \
  --location=us-central1
```

## Troubleshooting

### 500 Internal Server Error / Watchlist Stocks "Loading..."

**Symptoms**: All API calls return 500, watchlist stock prices show "Loading..." indefinitely.

**Cause**: The frontend `next.config.js` proxy is pointing to the wrong backend URL. This happens if:
- The config was accidentally set to localhost (`http://127.0.0.1:8000`) for production
- The `NODE_ENV` check was removed or broken

**Solution**:
1. Check `frontend/next.config.js` and verify the production URL is correct:
   ```javascript
   const apiUrl = process.env.NODE_ENV === 'production' 
       ? 'https://vinsight-backend-wddr2kfz3a-uc.a.run.app'  // Must be Cloud Run URL
       : 'http://127.0.0.1:8000';
   ```
2. Redeploy the frontend after fixing.

**Verification**: Test the proxy is working in production:
```bash
curl -s https://vinsight-frontend-wddr2kfz3a-uc.a.run.app/api/data/quote/AAPL
# Should return JSON stock quote, not "Internal Server Error"
```

---

### "Failed to load watchlists" / 404 Errors

**Cause**: Next.js proxy strips trailing slashes. FastAPI by default redirects to trailing-slash URLs via 307, but cookies are lost during redirect.

**Solution** (Already Applied):
1. `main.py` has `redirect_slashes=False` in FastAPI config
2. Routes use dual decorators: `@router.get("")` and `@router.get("/")`

---

### View Backend Logs
```bash
export PATH="$(pwd)/google-cloud-sdk/bin:$PATH"
gcloud run services logs read vinsight-backend --region us-central1 --limit 50
```



==========================================
FILE: docs/DEVELOPER_GUIDE.md
==========================================
# Developer Guide: Manual Stock Scoring

This guide explains how to manually test the VinSight Scoring Engine script without the full web interface.

## 1. Manual Evaluation Script
To evaluate a stock manually, you can use the `vinsight_scorer.py` script directly.

### Template Code
```python
from vinsight_scorer import VinSightScorer, StockData, Fundamentals, Technicals, Sentiment, Projections

new_stock = StockData(
    ticker="AAPL",
    # Fundamentals
    fundamentals=Fundamentals(
        inst_ownership=60.5,
        pe_ratio=28.0,
        analyst_upside=10.0
    ),
    # Technicals
    technicals=Technicals(
        price=150.0,
        sma50=145.0,
        sma200=140.0,
        rsi=45.0,
        momentum_label="Bullish",
        volume_trend="Price Rising + Vol Rising"
    ),
    # Sentiment
    sentiment=Sentiment(
        sentiment_label="Neutral",
        insider_activity="Mixed/Minor Selling"
    ),
    # Projections
    projections=Projections(
        monte_carlo_p50=160.0,
        current_price=150.0,
        risk_reward_gain_p90=20.0,
        risk_reward_loss_p10=10.0
    )
)

# Run Evaluation
scorer = VinSightScorer()
result = scorer.evaluate(new_stock)
scorer.print_report(new_stock, result)
```

### Running the Evaluation
```bash
cd backend/services
python3 vinsight_scorer.py
```

## 2. API Testing
For testing endpoints directly:
- **FastAPI Docs**: `http://localhost:8000/docs` (Swagger UI)
- **Monitoring**: Check `backend.log` for real-time API request tracing.



==========================================
FILE: docs/FEATURES.md
==========================================
# VinSight Features

## 1. Real-Time Dashboard
- **Candlestick Chart**: Professional charts built with `lightweight-charts`.
- **Intraday & Historical**: Switch between 1D, 1W, 1M, and 1Y views.
- **Watchlists**: Manage multiple portfolios with real-time price updates.

## 2. Artificial Intelligence Engine
- **Hybrid Sentiment Analysis**: Blended scores from Alpha Vantage, Finnhub, and Groq (Llama 3.3).
- **Deep Reasoning**: AI-driven "Thesis" and "Risk" analysis via Gemini 1.5 Pro.
- **Insider Intelligence**: 
    - **MSPR Tracking**: Monthly Share Purchase Ratio from SEC filings.
    - **10b5-1 Filter**: Distinguishes planned trades from discretionary executive action.
- **Spin Detection**: Automated detection of "positive framing" on negative financial news.

## 3. VinSight Score v9.0
Institutional-grade scoring with adaptive sector intelligence.
- **70/30 Weighted model** (Fundamentals/Technicals).
- **Dynamic Benchmarking**: Automatically adjusts "fair value" based on 12+ industry themes.
- **Veto Logic**: Automatic caps for insolvency or extreme overvaluation.
- **[Read Full Scoring Logic](./SCORING_ENGINE.md)**

## 4. Advanced Projections
- **Monte Carlo Scenarios**: Bull (P90), Base (P50), and Bear (P10) price targets.
- **Risk Assessment**: Value at Risk (VaR), Annualized Volatility, and Probability of hitting +25%/-25%.
- **Analyst Consensus**: Yahoo Finance target prices and recommendation trends.

## 5. Smart Alerts
- **Price Triggers**: Notification when a stock hits your target.
- **Execution**: Background monitoring via Cloud Scheduler.
- **Delivery**: Instant email notifications via SMTP.

## 6. Security & Persistence
- **Guest Mode**: Try the app with LocalStorage-persisted watchlists.
- **Secure Auth**: JWT-based login with email verification and hashed passwords.
- **[Read Security Documentation](./SECURITY.md)**




==========================================
FILE: docs/GROQ_SETUP.md
==========================================
# Quick Start: Setting Up Groq API for VinSight v2

## What is Groq?

Groq provides ultra-fast LLM inference using Llama 3.1 70B. VinSight v2 uses it for **deep sentiment analysis** with reasoning on important news.

**Benefits:**
- üéØ More accurate sentiment on complex financial news
- üß† Provides reasoning for sentiment decisions
- ‚ö° Very fast (sub-second responses)
- üí∞ **Free tier available!**

---

## Setup (2 minutes)

### Step 1: Get Your Free API Key

1. Go to [console.groq.com](https://console.groq.com)
2. Sign up (free account)
3. Navigate to **API Keys**
4. Click **Create API Key**
5. Copy your key (starts with `gsk_...`)

### Step 2: Add to Your Project

```bash
# In your terminal
cd /Users/vinayak/Documents/Antigravity/Project\ 1

# Add the API key to .env file
echo "GROQ_API_KEY=gsk_your_actual_key_here" >> backend/.env

# Restart the backend server (it will pick up the new key)
# The uvicorn process should reload automatically
```

### Step 3: Verify It Works

Once restarted, the backend will automatically use Groq for deep analysis mode. You'll see:
- **Sentiment source** in UI: "Hybrid" or "Groq" (instead of just "FinBERT")
- **More accurate sentiment** on complex earnings news
- **No change to speed** - Groq only runs on important headlines

---

## How It Works

### Without Groq API (Default - FinBERT Only)
```
News ‚Üí FinBERT (local) ‚Üí Sentiment with confidence
```
- ‚úÖ Free, no API needed
- ‚úÖ Fast (200ms for 10 headlines)
- ‚úÖ Good accuracy (~85%)

### With Groq API (Hybrid Mode)
```
News ‚Üí FinBERT (all headlines) + Groq (top 3 recent) ‚Üí Blended sentiment
‚îú‚îÄ 70% weight: FinBERT (fast batch analysis)
‚îî‚îÄ 30% weight: Groq (deep analysis with reasoning)
```
- ‚úÖ Excellent accuracy (~90%)
- ‚úÖ Provides reasoning
- ‚úÖ Still fast (~300ms for 10 headlines)

**Example Output:**
```json
{
  "label": "Positive",
  "score": 0.85,
  "confidence": 0.92,
  "source": "hybrid",  // ‚Üê Shows it used both
  "reasoning": "Strong earnings beat with raised guidance..."
}
```

---

## Cost

**Groq Pricing (as of Dec 2024):**
- Free tier: 14,400 requests/day
- After free tier: ~$0.27 per 1M input tokens

**VinSight Usage:**
- ~3 Groq calls per stock analysis (top 3 headlines)
- ~300 tokens per call
- **Estimate: ~15,000 analyses/month FREE**

---

## Troubleshooting

### "Groq API key not found"
- Check `.env` file exists in `backend/` directory
- Verify key format: `GROQ_API_KEY=gsk_...`
- Restart backend server

### "HTTP 429 - Rate limit exceeded"
- Wait 1 minute (rate limit resets)
- Or disable Groq temporarily (will fallback to FinBERT only)

### Still seeing "FinBERT" instead of "Hybrid"
- Check backend logs for errors
- Groq only runs when `deep_analysis=True` (default for some endpoints)
- FinBERT alone is still excellent - Groq is optional enhancement

---

## Next Steps

1. **Set up your Groq API key** (instructions above)
2. **Test it**: Search for a stock (e.g., AAPL, TSLA)
3. **Check the UI**: Should show "Sentiment: Hybrid" or "Sentiment: Groq"
4. **Enjoy better sentiment analysis!** üéâ

---

## Disable Groq (Optional)

To disable Groq and use only FinBERT:
```bash
# Remove or comment out the Groq API key
# GROQ_API_KEY=your_key

# Restart backend
```

VinSight will automatically fall back to FinBERT-only mode.



==========================================
FILE: docs/MAINTENANCE_LOG.md
==========================================
# VinSight Maintenance & Incident Log

This document records major system fixes, Root Cause Analyses (RCAs), and architectural optimizations.

## [2026-02-01] Yahoo Finance Rate Limit RCA
**Issue:** Stocks failing to load with "Too Many Requests" (HTTP 429) error.
**Root Cause:** Yahoo's `query1` endpoint aggressively blocks requests without modern browser TLS fingerprints and proper User-Agents.
**Resolution:** 
- Switched to `query2.finance.yahoo.com`.
- Implemented `curl_cffi` style handling (by allowing `yfinance` to manage its own session).
- Added aggressive 1-hour caching to reduce redundant calls.
**Files:** `backend/services/yahoo_client.py` (legacy fallback), `backend/services/finance.py`.

## [2026-01-29] Alert System Overhaul
**Issue:** Alert notifications were using `alert()` (blocked by browsers) and limits weren't enforced.
**Fixes:**
- Replaced all JS `alert()` calls with a dynamic Toast notification system (green/red/blue).
- **Limit Enforcement:** Added backend checks for Monthly Trigger Limit (default 10) and Active Alert Count (max 50).
- **UI:** Added usage progress bars to the Alert Modal.
**Files:** `frontend/src/components/AlertModal.tsx`, `backend/routes/alerts.py`.

## [2024-12-15] Sentiment Bias Fix (v2.2)
**Issue:** Sentiment analysis was biased ~89% positive due to financial news "spin".
**Fixes:**
- Enabled Groq AI (Llama 3.3 70B) by default for deep reasoning.
- Implemented Bearish Keyword Detection (25+ terms like "layoffs", "miss", "loss").
- **Spin Detection:** Penalizes score if bearish keywords are present but sentiment label is positive.
- Raised positive threshold from 0.3 to 0.5.
**Result:** Reduced positive bias from 89% to 33%.

## [Ongoing] Email Credential Security
**Issue:** Hardcoded credentials or insecure storage.
**Status:** Unified under Google Secret Manager for production and `.env` for local. Ensure `SMTP_SERVER` and `SMTP_PORT` are correctly configured in `.env`.

---

### Legend
- **RCA:** Root Cause Analysis
- **Hotfix:** Immediate patch for production-breaking bug
- **Maint:** Routine cleanup or optimization



==========================================
FILE: docs/PERFORMANCE_OPTIMIZATION.md
==========================================
# Performance Optimization Journey (v9.0.0)

**Date**: February 02, 2026
**Version**: v9.0.0

## üöÄ Executive Summary

We have evolved from simple code-level speedups to a **Data-Efficient Architecture**. Page load times have stabilized below **0.8s**, and UI responsiveness has improved by **40%** through vertical layout consolidation and intelligent caching.

| Metric | v6.4 (Previous) | v9.0 (Current) | Improvement |
| :--- | :--- | :--- | :--- |
| **Pillar Scorer Latency** | ~120ms | ~45ms | **Institutional Speed** |
| **Total API Load (Dashboard)** | ~0.76s | **~0.68s** | **Sub-1s Baseline** |
| **UI Vertical Height** | 100% | 60% | **Density Optimization** |

---

## üõ†Ô∏è v9.0 Key Technical Changes

### 1. Dynamic Benchmark Caching
The v9.0 engine uses **Adaptive Sector Benchmarking**. To prevent the overhead of re-loading JSON config for every request, the benchmark layer is now pre-loaded and cached in memory at server startup.

### 2. Consolidated UI Payload (High Density)
The frontend components were refactored to reduce the number of DOM nodes. By merging "Today's Pulse" and "Weekly Trend" into a single two-column card, we reduced the layout recalculation overhead by **~15%**.

### 3. Vectorized Monte Carlo (Original v6.4 Improvement)
*(Existing vectorized implementation maintained for high-performance simulations)*
The simulation engine generates 10,000 price paths using **NumPy vectorization**, generating 900,000 data points in ~20ms.

---

## üõ†Ô∏è Legacy Technical Changes (v6.4)

### 1. Vectorized Monte Carlo Simulation
The previous implementation calculated 10,000 price paths using nested Python loops, which is computationally expensive. We refactored this to use **NumPy vectorization**, allowing us to generate the entire matrix of 900,000 steps ($10,000 \text{ sims} \times 90 \text{ days}$) in a single operation.

**Code Impact (`backend/services/simulation.py`):**
```python
# BEFORE (Loop-based)
for _ in range(simulations):
    # logic...

# AFTER (Vectorized)
shocks = np.random.normal(mu, sigma, (simulations, days))
path_multipliers = np.cumprod(1 + shocks, axis=1)
```

### 2. consolidated API Architecture
The frontend previously made three simultaneous requests to load a single stock page:
1.  `/history/{ticker}`
2.  `/stock/{ticker}` (Details)
3.  `/analysis/{ticker}` (Technical + Sent + Sim)

This caused "waterfall" loading effects and redundant DB/Network overhead. We unified these into a single optimized endpoint:
- **Endpoint**: `/api/data/analysis/{ticker}`
- **Payload**: now returns `history`, `stock_details`, `news`, `institutional`, and `simulation` in one JSON object.
- **Concurrency**: The backend uses `ThreadPoolExecutor` to fetch independent data sources (History, News, Info) in parallel threads while the main thread waits.

### 3. Frontend Optimization
The `Dashboard.tsx` component was updated to:
- Dispatch a single request on mount.
- Populate all state variables (`history`, `fundamentals`, `news`, `simulation`) from the unified response.
- Eliminate layout shifts caused by components loading at different times.

---

## üìä Benchmarks

Benchmarks were run on a local environment simulating production load.

### Simulation Benchmark
```bash
Running Benchmark with 10000 simulations over 90 days...
Old Implementation Time: 0.3995 seconds
Vectorized Time: 0.0196 seconds
```

### Full Flow Benchmark
```bash
Benchmarking New State for AAPL...
New Full Flow Time: 0.7651 seconds
VERIFICATION: SUCCESS - All consolidated data present.
```

## ‚úÖ Conclusion
The application is now significantly more responsive. The specific use of NumPy for financial modeling and the architectural shift to "Composite API Responses" has proven highly effective for this read-heavy workload.



==========================================
FILE: docs/PRD.md
==========================================
# VinSight Product Requirements Document (PRD)

**Version:** 9.0 (Dynamic Benchmark Model)
**Status:** Live in Production

## 1. Executive Summary
VinSight is an AI-powered financial analytics platform that democratizes institutional-grade investment research. It combines real-time technical analysis with Large Language Model (LLM) reasoning to provide clear, actionable insights ("VinSight Score") for retail investors.

## 2. Target Audience
- **Self-Directed Investors**: Looking for data-backed conviction without reading 10-Ks for hours.
- **Swing Traders**: Needing quick technical setups and sentiment pulse checks.
- **Financial Analysts**: Seeking an AI-augmented "second opinion" on stock valuations.

## 3. Core Product Pillars

### 3.1 AI-Driven Sentiment
- Multi-source sentiment aggregation (News, SEC Filings, Insider Activity).
- Deep reasoning via LLMs to filter out "market noise" and detect bias/spin.
- Insider conviction scoring (Discretionary vs. Automatic 10b5-1 trades).

### 3.2 Dynamic Scoring (VinSight Score)
- **Quality (70%)**: Industry-relative fundamental health (Margins, ROE, Debt).
- **Timing (30%)**: Technical momentum and risk-adjusted volatility (Trend, RSI, Beta).
- **Veto Logic**: Absolute "Kill Switches" for high-risk flags (Insolvency, Extreme Overvaluation).

### 3.3 Advanced Projections
- **Monte Carlo Engine**: Simulating 10,000+ price paths to define Bull/Base/Bear scenarios.
- **Risk Metrics**: Probability of loss, Value at Risk (VaR), and Analyst Consensus integration.

### 3.4 Active Monitoring
- User-defined price and sentiment alerts.
- Real-time watchlist performance tracking.

## 4. User Experience Goals
- **High-Density Data**: Dashboard must show critical "at-a-glance" status without overwhelming users.
- **Mobile Responsive**: Full professional analysis available on any device.
- **Minimal Latency**: Core analysis results delivered in < 2 seconds.

## 5. Success Metrics
- **Engagement**: User retention on daily watchlist checks.
- **Accuracy**: Alignment of automated AI analysis with realized market catalysts.
- **Performance**: 99.9% uptime during US market hours.

---
See **[Architecture Overview](./ARCHITECTURE.md)** for technical implementation details.




==========================================
FILE: docs/SCORING_ENGINE.md
==========================================
# VinSight Scoring Engine Documentation

This document describes the evolution and inner workings of the VinSight Scoring Engine, used to provide institutional-grade equity analysis.

## Current Version: v9.0 (The Dynamic Benchmark Model)
**Release Date:** February 2026
**Philosophy:** "Institutional Precision." Adaptive intelligence that recalibrates thresholds based on 12+ industry themes.

### 1. The Core Equation
The score (0-100) is a weighted average of Fundamental Quality and Technical Timing.

```python
Final Score = (Quality Score * 0.70) + (Timing Score * 0.30)
```

| Factor | Weight | Scoring Mechanism |
| :--- | :--- | :--- |
| **Quality Score** | 70% | Linear Interpolation against **Sector Benchmarks** |
| **Timing Score** | 30% | Linear Interpolation against **Volatility (Beta) Context** |

### 2. Adaptive Fundamentals (Quality)
*Philosophy: "A 15% margin is weak for Software, but elite for Retail."*

The following metrics are dynamically adjusted based on the stock's classified theme:

| Metric | Ideal (Max Pts) | Zero (0 Pts) |
| :--- | :--- | :--- |
| **PEG Ratio** | `sector_peg_fair` | `sector_peg_fair + 2.0` |
| **FCF Yield** | `sector_fcf_yield_strong` | `sector_fcf_yield * 0.2` |
| **ROE** | `sector_roe_strong` | `sector_roe * 0.3` |
| **Net Margin** | `sector_margin_healthy`| `sector_margin * 0.4` |
| **Debt/EBITDA**| `sector_debt_safe` | `sector_debt * 2.0` |
| **Rev Growth** | `sector_growth_strong` | `0.0%` |

### 3. Contextual Timing
*Philosophy: "Trend is relative to volatility."*

- **Beta Score**: Targets are shifted based on the `beta_safe` benchmark for that sector.
- **RSI Support**: Interpretation of 40-65 zone persists, with volume confirmation relative to sector liquidity.

### 4. Kill Switches (Vetos)
Vetos override the weighted average to cap the maximum possible score if a fatal flaw is detected:

1.  **Insolvency Veto**: `Interest Coverage < 1.5x`. Score capped at **40 (Strong Sell)**.
2.  **Valuation Veto**: `PEG Ratio > 4.0`. Quality Score capped at **50**.
3.  **Downtrend Veto**: `Price < SMA200` AND `Price < SMA50`. Timing Score capped at **30**.

---

## Evolution History

### v8.0: The CFA Weighted Composite Model
Introduced the 70/30 weighting and the concept of "Kill Switches" (Vetos). Moved away from simple additive sums to a institutional-style composite score.

### v7.4: The Fundamental Purist
Focused exclusively on business quality (Valuation, Profitability, Efficiency, Solvency). Technicals were used only as negative "Risk Gates" (subtracting points) but could not add points.

### v2.2: Hybrid Sentiment & PEG Integration
Included first-generation sentiment analysis (FinBERT + Groq) and integrated the PEG ratio to correctly score growth stocks.

---

## Sector Benchmarks (Themes)
VinSight dynamically maps stocks to 12+ Wealth Manager Themes:
- üíª Tech & Growth
- üíæ Semiconductors
- üè¢ Blue Chips
- üí∞ Financials
- üè• Healthcare
- üõçÔ∏è Consumer Discretionary
- üõí Consumer Staples
- üõ¢Ô∏è Energy & Materials
- üèóÔ∏è Industrials
- ‚ö° Utilities
- üß± Materials & Mining
- üè† Real Estate (REITs)
- üå± Small Caps



==========================================
FILE: docs/SECURITY.md
==========================================
# VinSight Security Documentation

This document summarizes the security architecture, audits, and compliance status of the VinSight platform.

## 1. Security Architecture

### Authentication & Authorization
- **JWT Authentication**: Secure token-based access for all protected endpoints.
- **Password Hashing**: PBKDF2 with 29,000+ iterations and unique salts per user.
- **Session Management**: Secure, HttpOnly, and SameSite cookies used for web sessions.
- **Rate Limiting**: Protection against brute-force attacks via SlowAPI (e.g., 5/min on login).

### Data Protection
- **Encryption at Transit**: TLS 1.3 enforced for all browser-to-server communications.
- **Encryption at Rest**: Google Cloud SQL automatically encrypts all database volumes.
- **Secret Management**: All sensitive keys (API keys, DB passwords) are stored in **Google Secret Manager**, never in source code.

### Network Security
- **Cloud Run Isolation**: Backend and Frontend run in isolated container environments.
- **CORS Configuration**: Restrictive cross-origin policies applied based on environment.

---

## 2. Compliance Status (as of Feb 2026)

VinSight is tracked against major industry frameworks:

| Framework | Score | Status |
| :--- | :--- | :--- |
| **OWASP Top 10** | 82/100 | ‚úÖ Good (Strong injection/SSRF protection) |
| **NIST CSF** | 2.2/5.0 | ‚ö†Ô∏è Developing (Managed maturity) |
| **CIS Controls** | 46/100 | ‚ùå Needs Work (MFA & Auto-scanning pending) |

### Key Strengths
- **A03:2021 (Injection)**: 100% compliance via SQLAlchemy ORM and Pydantic validation.
- **A10:2021 (SSRF)**: 100% compliance via network segmentation and URL allowlisting.

### Top Security Recommendations
1. **Multi-Factor Authentication (MFA)**: Implement TOTP for privileged accounts.
2. **Password Complexity**: Enforce 12+ character minimum with symbol requirements.
3. **Automated Scanning**: Integrate Dependabot or Snyk for dependency vulnerability checks.

---

## 3. Incident Response & Rotation

### Rotation Schedule
- **Gmail App Passwords**: Every 90 days.
- **JWT Secret Key**: Every 180 days (invalidates current user sessions).
- **API Keys**: Per vendor recommendations or upon suspected exposure.

### Compromise Protocol
1. **Revoke Exposed Credentials** (Gmail, GitHub, etc.).
2. **Rotate Secrets** in Google Secret Manager.
3. **Redeploy Services** to pick up new secret versions.
4. **Audit Logs** (Cloud Logging) for unauthorized access patterns.

---

## 4. Security Audit History
- **2026-01-17**: Credential Sanitization Audit. Removed all plaintext passwords from local scripts and documentation. Verified `.env` permissions set to `600`.
- **2026-02-02**: V9.0 Compliance Check. Baseline established for SOC 2 readiness.



==========================================
FILE: docs/SETUP.md
==========================================
# VinSight Setup Guide

## Prerequisites

- **Python 3.10+**: [Download](https://www.python.org/downloads/)
- **Node.js 20+**: [Download](https://nodejs.org/en) (LTS version recommended)
- **Git**: [Download](https://git-scm.com/downloads)

## Development Environment Setup

### 1. Database
VinSight uses SQLite for local development. No installation required; the file `backend/finance.db` will be created automatically.

### 2. API Keys
You strictly need these keys for the app to function correctly:
1.  **JWT Secret**: Generate any random string.
2.  **API Ninjas**: For stock price data.
3.  **Groq API**: For fast AI sentiment analysis.
4.  **Google Gemini**: For deep reasoning analysis.
5.  **Finnhub API**: For institutional data and real-time news.

### 3. Backend (FastAPI)

```bash
cd backend
python -m venv venv
source venv/bin/activate  # macOS/Linux
# venv\Scripts\activate   # Windows

pip install -r requirements.txt
python main.py  # Or use uvicorn main:app --reload
```
*The server will run on `http://localhost:8000`*

### 4. Frontend (Next.js)

```bash
cd frontend
npm install
npm run dev
```
*The UI will run on `http://localhost:3000`*

## Running Tests
We have moved verification scripts to `scripts/verify/`.
To run them:
```bash
python -m scripts.verify.verify_alert_creation
```
*(Make sure you are in the root directory)*



